<!DOCTYPE html>
<html>
<head>
    <title>Test Remember Me</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px 15px; margin: 5px; }
        input { padding: 8px; margin: 5px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Remember Me Functionality Test</h1>
    
    <div class="test-section">
        <h3>Test Login Form</h3>
        <input type="email" id="testEmail" placeholder="Email" value="test@example.com">
        <input type="password" id="testPassword" placeholder="Password" value="password123">
        <br>
        <input type="checkbox" id="testRememberMe">
        <label for="testRememberMe">Remember me for 30 days</label>
        <br>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testLogout()">Test Logout</button>
        <button onclick="checkAuth()">Check Auth Status</button>
        <button onclick="clearStorage()">Clear Storage</button>
    </div>

    <div class="test-section">
        <h3>Results</h3>
        <div id="results" class="result">Test results will appear here...</div>
    </div>

    <script src="js/api-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }

        function testLogin() {
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            const rememberMe = document.getElementById('testRememberMe').checked;
            
            log('Testing login with rememberMe=' + rememberMe);
            
            // Mock login data
            const mockData = {
                user_id: 123,
                username: 'testuser',
                email: email
            };
            
            // Save email if remember me is checked
            if (rememberMe) {
                auth.saveEmail(email);
                log('Email saved: ' + email);
            } else {
                auth.clearSavedEmail();
                log('Email cleared');
            }
            
            // Set auth
            auth.setAuth(mockData, rememberMe);
            log('Auth set successfully');
            
            // Check auth status
            checkAuth();
        }

        function testLogout() {
            auth.logout();
            log('Logged out successfully');
            checkAuth();
        }

        function checkAuth() {
            const isAuthenticated = auth.isAuthenticated();
            const userId = auth.getUserId();
            const username = auth.getUsername();
            const savedEmail = auth.getSavedEmail();
            const authData = auth.getAuth();
            
            log('=== Auth Status ===');
            log('Authenticated: ' + isAuthenticated);
            log('User ID: ' + userId);
            log('Username: ' + username);
            log('Saved Email: ' + savedEmail);
            
            if (authData) {
                log('Remember Me: ' + (authData.rememberMe || false));
                log('Expires At: ' + authData.expiresAt);
                log('Login Time: ' + authData.loginTime);
            }
            log('==================');
        }

        function clearStorage() {
            localStorage.clear();
            log('Local storage cleared');
            checkAuth();
        }

        // Check auth on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedEmail = auth.getSavedEmail();
            if (savedEmail) {
                document.getElementById('testEmail').value = savedEmail;
                document.getElementById('testRememberMe').checked = true;
                log('Email pre-filled from saved data: ' + savedEmail);
            }
            checkAuth();
        });
    </script>
</body>
</html>